<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´í˜ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        :root { --primary: #4a3f35; --bg: #f5f5f5; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        .hidden { display: none !important; }
        #login-container { max-width: 400px; margin: 80px auto; padding: 30px; background: #fff; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        header { background: var(--primary); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .nav-tabs { display: flex; gap: 5px; padding: 10px; background: #e0e0e0; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: #d1d1d1; cursor: pointer; }
        .tab-btn.active { background: #fff; font-weight: bold; }
        .card { background: #fff; margin: 15px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f8f8f8; }
    </style>
</head>
<body>

<div id="login-container">
    <h2>â˜• ì¹´í˜ ê´€ë¦¬ ë¡œê·¸ì¸</h2>
    <input type="text" id="user-id" placeholder="ì•„ì´ë””" aria-label="ì•„ì´ë””">
    <input type="password" id="user-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" aria-label="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="handleLogin()">ë¡œê·¸ì¸</button>
</div>

<div id="main-app" class="hidden">
    <header>
        <span id="user-info">ì ‘ì† ì¤‘...</span>
        <button onclick="location.reload()" style="width:auto; padding: 5px 15px;">ë¡œê·¸ì•„ì›ƒ</button>
    </header>
    
    <nav class="nav-tabs">
        <button class="tab-btn active" id="btn-write" onclick="showTab('write')">ê¸°ë¡í•˜ê¸°</button>
        <button class="tab-btn hidden" id="btn-admin" onclick="showTab('admin')">ì „ì²´ ì·¨í•©</button>
    </nav>

    <main class="content">
        <div id="sec-write" class="card">
            <h3>ğŸ“ ì‹ ê·œ ë‚´ì—­ ê¸°ë¡</h3>
            <select id="log-type" title="ê¸°ë¡ ìœ í˜• ì„ íƒ">
    <optgroup label="[í’ˆì§ˆ/ìƒì‚°]">
        <option value="ì›ë‘ ë¡œìŠ¤íŒ… í’ˆì§ˆ">ğŸ”¥ ì›ë‘ ë¡œìŠ¤íŒ… í’ˆì§ˆ (Giesen)</option>
        <option value="ë² ì´ì»¤ë¦¬ ìƒì‚°/í’ˆì ˆ">ğŸ¥ ë² ì´ì»¤ë¦¬ ìƒì‚° ë° í’ˆì ˆ</option>
    </optgroup>
    <optgroup label="[ë§¤ì¥ ìš´ì˜]">
        <option value="ê³ ê° ì»´í”Œë ˆì¸">âš ï¸ ê³ ê° ì»´í”Œë ˆì¸</option>
        <option value="ì‹œì„¤ ë³´ìˆ˜/ì²­ê²°">ğŸ”§ ì‹œì„¤ ë³´ìˆ˜ ë° ì²­ê²°</option>
        <option value="ì§ì› ìš”ì²­/ì•ˆê±´">ğŸ™‹ ì§ì› ìš”ì²­ ë° ì•ˆê±´</option>
    </optgroup>
</select>
            <textarea id="log-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." title="ë‚´ì—­ ìƒì„¸ ë‚´ìš©"></textarea>
            <button onclick="saveLog()">ê¸°ë¡ ì œì¶œ</button>
        </div>

        <div id="sec-admin" class="card hidden">
            <h3>ğŸ“Š ì „ ë§¤ì¥ í†µí•© ë¦¬í¬íŠ¸</h3>
            <table>
                <thead>
                    <tr><th>ë‚ ì§œ</th><th>ë§¤ì¥</th><th>êµ¬ë¶„</th><th>ë‚´ìš©</th></tr>
                </thead>
                <tbody id="admin-list">
                    </tbody>
            </table>
        </div>
    </main>
</div>

<script>
    /** * [í•„ë…] API_URL ë¶€ë¶„ì„ ë³¸ì¸ì˜ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì›¹ ì•± URLë¡œ ë°˜ë“œì‹œ ìˆ˜ì •í•˜ì„¸ìš”! 
     * ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë©´ ë¡œê·¸ì¸ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
     */
    const API_URL = "https://script.google.com/macros/s/AKfycbzBRJ0rCm-BJcc-cbJUKUmAi_OSx2HSH-yGgqvyOHHRSki6XtKewZl1eaVeqauBDU4a/exec"; 
    
    let currentUser = null;

    async function handleLogin() {
        const id = document.getElementById('user-id').value;
        const pw = document.getElementById('user-pw').value;

        if (!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (API_URL.includes("ì—¬ê¸°ì—")) return alert("API_URL ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤ (ì½”ë“œ ìˆ˜ì • í•„ìš”).");

        try {
            const resp = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'login', id, pw })
            });
            const result = await resp.text();

            if (result !== "Fail") {
                const data = JSON.parse(result);
                currentUser = { id, role: data.role };
                initApp();
            } else {
                alert("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        } catch (e) {
            console.error(e);
            alert("ì—°ê²° ì˜¤ë¥˜: êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.");
        }
    }

    function initApp() {
        document.getElementById('login-container').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        document.getElementById('user-info').innerText = `${currentUser.id}ë‹˜ (${currentUser.role})`;
        
        if (currentUser.role === 'admin') {
            document.getElementById('btn-admin').classList.remove('hidden');
        }
    }

    function showTab(tabId) {
        document.getElementById('sec-write').classList.toggle('hidden', tabId !== 'write');
        document.getElementById('sec-admin').classList.toggle('hidden', tabId !== 'admin');
        document.getElementById('btn-write').classList.toggle('active', tabId === 'write');
        document.getElementById('btn-admin').classList.toggle('active', tabId === 'admin');
        if (tabId === 'admin') loadLogs();
    }

    async function saveLog() {
        const type = document.getElementById('log-type').value;
        const content = document.getElementById('log-content').value;
        if (!content) return alert("ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”.");

        // ì•„ì´ë””ì— '1'ì´ í¬í•¨ë˜ë©´ 1í˜¸ì , '2'ê°€ í¬í•¨ë˜ë©´ 2í˜¸ì ìœ¼ë¡œ ì„ì‹œ ë¶„ë¥˜
        const branch = currentUser.role === 'admin' ? 'ë³¸ì‚¬' : (currentUser.id.includes('1') ? '1í˜¸ì ' : '2í˜¸ì ');

        try {
            await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'saveLog', id: currentUser.id, branch, type, content })
            });
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
            document.getElementById('log-content').value = '';
        } catch (e) {
            alert("ì €ì¥ ì‹¤íŒ¨");
        }
    }

    async function loadLogs() {
        const list = document.getElementById('admin-list');
        list.innerHTML = "<tr><td colspan='4'>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>";
        try {
            const resp = await fetch(API_URL);
            const data = await resp.json();
            list.innerHTML = '';
            data.slice(1).reverse().forEach(row => {
                list.innerHTML += `<tr><td>${new Date(row[0]).toLocaleDateString()}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td></tr>`;
            });
        } catch (e) {
            list.innerHTML = "<tr><td colspan='4'>ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</td></tr>";
        }
    }
</script>
</body>
</html>
