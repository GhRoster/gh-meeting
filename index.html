<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¸ë¼ìš´ë“œí—¤ë¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        :root { --primary: #2c3e50; --accent: #e67e22; --bg: #f4f7f6; }
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background: var(--bg); margin: 0; }
        .hidden { display: none !important; }
        
        /* ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ */
        #login-container { max-width: 400px; margin: 80px auto; padding: 30px; background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .logo-text { font-size: 28px; font-weight: bold; color: var(--primary); margin-bottom: 20px; letter-spacing: 1px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 15px; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        button:hover { opacity: 0.9; }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        header { background: var(--primary); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .nav-tabs { display: flex; background: #fff; border-bottom: 1px solid #ddd; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; cursor: pointer; font-size: 14px; color: #7f8c8d; }
        .tab-btn.active { color: var(--accent); border-bottom: 3px solid var(--accent); font-weight: bold; }
        
        .content { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: left; }
        th { background: #f9f9f9; color: #34495e; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; color: white; }
        .admin { background: #e74c3c; } .manager { background: #3498db; } .staff { background: #95a5a6; }
    </style>
</head>
<body>

<div id="login-container">
    <div class="logo-text">Ground Heaven</div>
    
    <div id="login-form">
        <input type="text" id="user-id" placeholder="ì•„ì´ë”” (í•œê¸€ ê°€ëŠ¥)">
        <input type="password" id="user-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button onclick="handleLogin()">ë¡œê·¸ì¸</button>
        <p style="font-size: 13px; color: #666; margin-top: 20px; cursor: pointer;" onclick="toggleForm(true)">ìƒˆ ê³„ì • ë§Œë“¤ê¸°</p>
    </div>

    <div id="register-form" class="hidden">
        <input type="text" id="reg-id" placeholder="ì‚¬ìš©í•  ì•„ì´ë”” (í•œê¸€ ê°€ëŠ¥)">
        <input type="password" id="reg-pw" placeholder="ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸">
        <select id="reg-role">
            <option value="staff">ì¼ë°˜ì§ì›</option>
            <option value="manager">ë§¤ë‹ˆì €</option>
            <option value="admin">ê´€ë¦¬ì (ëŒ€í‘œ/ì‚¬ì¥/ì‹¤ì¥)</option>
        </select>
        <button onclick="handleRegister()" style="background: var(--accent);">íšŒì›ê°€ì… ì™„ë£Œ</button>
        <p style="font-size: 13px; color: #666; margin-top: 20px; cursor: pointer;" onclick="toggleForm(false)">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</p>
    </div>
</div>

<div id="main-app" class="hidden">
    <header>
        <span style="font-weight: bold;">Ground Heaven System</span>
        <span id="user-display" style="font-size: 13px;"></span>
        <button onclick="location.reload()" style="width:auto; padding: 5px 10px; font-size: 11px; background: rgba(255,255,255,0.2);">ë¡œê·¸ì•„ì›ƒ</button>
    </header>

    <nav class="nav-tabs">
        <button class="tab-btn active" id="tab-write" onclick="showTab('write')">ê¸°ë¡í•˜ê¸°</button>
        <button class="tab-btn hidden" id="tab-view" onclick="showTab('view')">ê¸°ë¡ì¡°íšŒ(ë§¤ë‹ˆì €)</button>
        <button class="tab-btn hidden" id="tab-admin" onclick="showTab('admin')">ì „ì²´ì·¨í•©(ê´€ë¦¬ì)</button>
    </nav>

    <div class="content">
        <div id="sec-write" class="card">
            <h3>ğŸ“ ì˜¤ëŠ˜ì íŠ¹ì´ì‚¬í•­ ê¸°ë¡</h3>
            <select id="log-type" title="ì¹´í…Œê³ ë¦¬ ì„ íƒ">
                <option value="ê³ ê° ì»´í”Œë ˆì¸">âš ï¸ ê³ ê° ì»´í”Œë ˆì¸</option>
                <option value="ì†ë‹˜ ìš”ì²­ì‚¬í•­">ğŸ’¬ ì†ë‹˜ ìš”ì²­ì‚¬í•­</option>
                <option value="ë§¤ì¥ ë³´ìˆ˜ í•„ìš”">ğŸ”§ ë§¤ì¥ ë³´ìˆ˜ í•„ìš”</option>
                <option value="ì§ì› ìš”ì²­ ì‚¬í•­">ğŸ™‹ ì§ì› ìš”ì²­ ì‚¬í•­</option>
                <option value="ë¡œìŠ¤íŒ… í’ˆì§ˆ">ğŸ”¥ ì›ë‘/ë¡œìŠ¤íŒ… í”¼ë“œë°±</option>
            </select>
            <textarea id="log-content" style="height: 150px;" placeholder="ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <button onclick="saveLog()">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
        </div>

        <div id="sec-view" class="card hidden">
            <h3>ğŸ“‘ ë§¤ì¥ë³„ ê¸°ë¡ í˜„í™©</h3>
            <table id="view-table">
                <thead><tr><th>ë‚ ì§œ</th><th>êµ¬ë¶„</th><th>ë‚´ìš©</th></tr></thead>
                <tbody id="view-list"></tbody>
            </table>
        </div>

        <div id="sec-admin" class="card hidden">
            <h3>ğŸ“Š ì „ì‚¬ í†µí•© ë¦¬í¬íŠ¸</h3>
            <table id="admin-table">
                <thead><tr><th>ë‚ ì§œ</th><th>ì‘ì„±ì</th><th>êµ¬ë¶„</th><th>ë‚´ìš©</th></tr></thead>
                <tbody id="admin-list"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // [ì¤‘ìš”] ë³¸ì¸ì˜ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ URLì„ ì•„ë˜ì— ê¼­ ë„£ì–´ì£¼ì„¸ìš”!
    const API_URL = "https://script.google.com/macros/s/AKfycbwN1sXOinhK6auQALpCPhsMQZk5GP4ZDk-PmemSpWp5ty-S0ej5r7Yq_ODntVRK4fld/exec"; 
    let currentUser = null;

    function toggleForm(isReg) {
        document.getElementById('login-form').classList.toggle('hidden', isReg);
        document.getElementById('register-form').classList.toggle('hidden', !isReg);
    }

    // íšŒì›ê°€ì…
    async function handleRegister() {
        const id = document.getElementById('reg-id').value;
        const pw = document.getElementById('reg-pw').value;
        const role = document.getElementById('reg-role').value;
        if(!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        try {
            await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'register', id, pw, role })
            });
            alert("ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
            toggleForm(false);
        } catch (e) { alert("ê³„ì • ìƒì„± ì‹¤íŒ¨"); }
    }

    // ë¡œê·¸ì¸
    async function handleLogin() {
        const id = document.getElementById('user-id').value;
        const pw = document.getElementById('user-pw').value;

        try {
            const resp = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'login', id, pw })
            });
            const result = await resp.text();
            if(result !== "Fail") {
                const data = JSON.parse(result);
                currentUser = { id, role: data.role };
                initApp();
            } else { alert("ì •ë³´ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); }
        } catch (e) { alert("ì—°ê²° ì˜¤ë¥˜"); }
    }

    function initApp() {
        document.getElementById('login-container').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        document.getElementById('user-display').innerText = `${currentUser.id}ë‹˜ [${getRoleName(currentUser.role)}]`;

        // ê¶Œí•œë³„ íƒ­ í™œì„±í™”
        if(currentUser.role === 'manager' || currentUser.role === 'admin') {
            document.getElementById('tab-view').classList.remove('hidden');
        }
        if(currentUser.role === 'admin') {
            document.getElementById('tab-admin').classList.remove('hidden');
        }
    }

    function getRoleName(role) {
        if(role === 'admin') return 'ê´€ë¦¬ì';
        if(role === 'manager') return 'ë§¤ë‹ˆì €';
        return 'ì¼ë°˜ì§ì›';
    }

    function showTab(tabId) {
        document.querySelectorAll('.tab-content, .card').forEach(el => {
            if(el.id.startsWith('sec-')) el.classList.add('hidden');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        
        document.getElementById('sec-' + tabId).classList.remove('hidden');
        document.getElementById('tab-' + tabId).classList.add('active');
        
        if(tabId === 'view' || tabId === 'admin') loadLogs(tabId);
    }

    async function saveLog() {
        const type = document.getElementById('log-type').value;
        const content = document.getElementById('log-content').value;
        if(!content) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'saveLog', id: currentUser.id, type, content })
        });
        alert("ê¸°ë¡ì´ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        document.getElementById('log-content').value = '';
    }

    async function loadLogs(mode) {
        const resp = await fetch(API_URL);
        const data = await resp.json();
        const list = document.getElementById(mode + '-list');
        list.innerHTML = '';
        
        data.slice(1).reverse().forEach(row => {
            // ë§¤ë‹ˆì €ëŠ” ë°ì´í„° ì—´ëŒ ê°€ëŠ¥, ê´€ë¦¬ìëŠ” ì „ì²´ ì—´ëŒ
            list.innerHTML += `<tr>
                <td>${new Date(row[0]).toLocaleDateString()}</td>
                ${mode === 'admin' ? `<td>${row[1]}</td>` : ''}
                <td>${row[3]}</td>
                <td>${row[4]}</td>
            </tr>`;
        });
    }
</script>
</body>
</html>
